<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>Valentine Snake</title>

  <!-- Fancy font for the scroll note -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
    :root { --safe-top: env(safe-area-inset-top, 0px); --safe-bot: env(safe-area-inset-bottom, 0px); }
    html, body { height:100%; margin:0; background:#07040b; overflow:hidden; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; }
    #wrap { position:relative; height:100%; width:100%; display:grid; place-items:center; }
    canvas {
      width:min(100vw, calc(100vh * (360/640)));
      height:min(100vh, calc(100vw * (640/360)));
      image-rendering:pixelated;
      background:#000;
      border-radius:16px;
      box-shadow:0 18px 60px rgba(0,0,0,.55);
    }

    /* Top counter */
    #topHud{
      position:absolute;
      top:calc(10px + var(--safe-top));
      left:0; right:0;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index:5;
    }
    #counter{
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
      padding:6px 10px;
      border-radius:10px;
      color:#fff;
      font-weight:1000;
      text-shadow:0 2px 10px rgba(0,0,0,.7);
      letter-spacing:.2px;
    }

    /* D-pad */
    #dpad{
      position:absolute;
      left:14px;
      bottom:calc(14px + var(--safe-bot));
      width:150px;
      height:150px;
      display:none;
      z-index:6;
      pointer-events:auto;
      touch-action:none;
    }
    .dbtn{
      position:absolute;
      width:52px; height:52px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      color:#fff;
      font-weight:1000;
      font-size:20px;
      display:grid;
      place-items:center;
      user-select:none;
      -webkit-user-select:none;
    }
    .dbtn:active{ transform:scale(0.98); background:rgba(255,255,255,.10); }

    #up    { left:49px; top:0px; }
    #down  { left:49px; top:98px; }
    #left  { left:0px;  top:49px; }
    #right { left:98px; top:49px; }

    /* Small hint */
    #hint{
      position:absolute;
      right:14px;
      bottom:calc(14px + var(--safe-bot));
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
      padding:8px 10px;
      border-radius:12px;
      color:#fff;
      font-weight:900;
      font-size:12px;
      text-shadow:0 2px 10px rgba(0,0,0,.7);
      pointer-events:none;
      display:none;
      z-index:6;
      max-width:160px;
    }
  </style>
</head>

<body>
<div id="wrap">
  <canvas id="c" width="360" height="640"></canvas>

  <div id="topHud">
    <div id="counter">‚ù§ 0/50</div>
  </div>

  <div id="dpad">
    <div class="dbtn" id="up">‚ñ≤</div>
    <div class="dbtn" id="down">‚ñº</div>
    <div class="dbtn" id="left">‚óÄ</div>
    <div class="dbtn" id="right">‚ñ∂</div>
  </div>

  <div id="hint">Use arrows to move.</div>
</div>

<script>
(() => {
  // ===== Personalize =====
  const NAME = "Yara";
  const TARGET = 50;

  // ===== Canvas =====
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d", { alpha:false });
  ctx.imageSmoothingEnabled = false;
  const W = canvas.width, H = canvas.height;

  // ===== UI =====
  const counterEl = document.getElementById("counter");
  const dpad = document.getElementById("dpad");
  const hint = document.getElementById("hint");

  // ===== States =====
  // menuClosed -> menuOpen -> game -> scrollClosed -> scrollOpen
  let state = "menuClosed";

  // ===== Playfield =====
  const COLS = 20;
  const ROWS = 24;
  const CELL = 18;          // 20*18 = 360
  const fieldX = 0;
  const fieldY = 168;       // space for pixel sky + menu
  const fieldW = COLS*CELL;
  const fieldH = ROWS*CELL;

  // ===== Particles (petals) =====
  const petals = [];
  function seedPetals(n){
    for(let i=0;i<n;i++){
      petals.push({
        x: Math.random()*W,
        y: Math.random()*H,
        vx: -0.10 - Math.random()*0.25,
        vy:  0.20 + Math.random()*0.60,
        t: Math.random()*999
      });
    }
  }
  seedPetals(60);

  // ===== Snake =====
  let snake, dir, nextDir, food, score, won;

  function resetGame(){
    snake = [{x:10,y:12},{x:9,y:12},{x:8,y:12}];
    dir = {x:1,y:0};
    nextDir = {x:1,y:0};
    score = 0;
    won = false;
    food = spawnFood();
    updateCounter();
  }

  function updateCounter(){
    counterEl.textContent = `‚ù§ ${score}/${TARGET}`;
  }

  function spawnFood(){
    while(true){
      const fx = (Math.random()*COLS)|0;
      const fy = (Math.random()*ROWS)|0;
      if(!snake?.some(s=>s.x===fx && s.y===fy)) return {x:fx,y:fy};
    }
  }

  function setDir(x,y){
    // no reverse
    if(x === -dir.x && y === -dir.y) return;
    nextDir = {x,y};
  }

  // ===== D-pad controls =====
  function bindBtn(id, x, y){
    const el = document.getElementById(id);
    const press = (e) => { e.preventDefault(); if(state==="game") setDir(x,y); };
    el.addEventListener("pointerdown", press);
    el.addEventListener("touchstart", press, {passive:false});
  }
  bindBtn("up", 0,-1);
  bindBtn("down", 0, 1);
  bindBtn("left",-1, 0);
  bindBtn("right", 1, 0);

  // ===== Tap flow =====
  canvas.addEventListener("click", () => {
    if(state === "menuClosed") { state = "menuOpen"; return; }
    if(state === "menuOpen") {
      state = "game";
      dpad.style.display = "block";
      hint.style.display = "block";
      resetGame();
      return;
    }
    if(state === "scrollClosed") { state = "scrollOpen"; return; }
  }, {passive:true});

  // ===== Drawing: more ‚Äúheavy pixel art‚Äù =====
  function pxRect(x,y,w,h,color){
    ctx.fillStyle = color;
    ctx.fillRect(x|0,y|0,w|0,h|0);
  }

  function drawChunkySky(t){
    // big pixel blocks for sky
    // top gradient-ish using bands
    pxRect(0,0,W,60,"#2a0b45");
    pxRect(0,60,W,60,"#ff5fa8");
    pxRect(0,120,W,48,"#ffb07a");

    // chunky sun
    pxRect((W/2-18), 48, 36, 36, "rgba(255,255,255,0.92)");
    pxRect((W/2-10), 58, 20, 20, "rgba(255,255,255,0.92)");

    // chunky clouds
    for(let i=0;i<4;i++){
      const x = 30 + i*80 + ((Math.sin(t*0.001+i)*6)|0);
      const y = 84 + ((i%2)*10);
      pxRect(x,y,34,12,"rgba(255,255,255,0.25)");
      pxRect(x+10,y-8,38,12,"rgba(255,255,255,0.22)");
      pxRect(x+26,y+6,28,10,"rgba(255,255,255,0.18)");
    }

    // sakura frame (top corners) ‚Äì chunkier
    drawSakuraCorner(true);
    drawSakuraCorner(false);

    // title band
    pxRect(12, 120, W-24, 34, "rgba(0,0,0,0.22)");
  }

  function drawSakuraCorner(left){
    const baseX = left ? 0 : W-140;
    const baseY = 0;

    // thick branch
    for(let i=0;i<10;i++){
      const x = baseX + (left ? i*12 : 140 - i*12);
      const y = baseY + i*5;
      pxRect(x, y, 28, 8, "#241022");
    }

    // blossoms (bigger pixels)
    for(let i=0;i<44;i++){
      const bx = baseX + ((Math.random()*140)|0);
      const by = baseY + ((Math.random()*95)|0);
      pxRect(bx, by, 8, 8, (i%3===0) ? "#ffb7d6" : "#ff7bb7");
      if(i%11===0) pxRect(bx+3, by+2, 2, 2, "rgba(255,255,255,0.35)");
    }
  }

  function drawPetals(){
    for(const p of petals){
      p.t += 1;
      p.x += p.vx;
      p.y += p.vy;
      if(p.y > H+12){ p.y = -12; p.x = Math.random()*W; }
      if(p.x < -12){ p.x = W+12; }

      const s = 5 + (Math.sin(p.t*0.03)*1.5);
      pxRect(p.x, p.y, s, s-2, "rgba(255,210,235,0.92)");
    }
  }

  function drawGridFloor(){
    // pink floor
    pxRect(fieldX, fieldY, fieldW, fieldH, "#ffb0d7");

    // low opacity grid lines
    ctx.strokeStyle = "rgba(255,255,255,0.16)";
    ctx.lineWidth = 1;
    for(let c=0;c<=COLS;c++){
      const x = fieldX + c*CELL + 0.5;
      ctx.beginPath(); ctx.moveTo(x, fieldY); ctx.lineTo(x, fieldY+fieldH); ctx.stroke();
    }
    for(let r=0;r<=ROWS;r++){
      const y = fieldY + r*CELL + 0.5;
      ctx.beginPath(); ctx.moveTo(fieldX, y); ctx.lineTo(fieldX+fieldW, y); ctx.stroke();
    }
  }

  function drawRoseBushBorder(){
    // rose bush border around the grid
    const pad = 14;
    const bx = fieldX - pad;
    const by = fieldY - pad;
    const bw = fieldW + pad*2;
    const bh = fieldH + pad*2;

    // green base
    pxRect(bx, by, bw, pad, "#2f7a52");              // top
    pxRect(bx, by+bh-pad, bw, pad, "#2f7a52");       // bottom
    pxRect(bx, by, pad, bh, "#2f7a52");              // left
    pxRect(bx+bw-pad, by, pad, bh, "#2f7a52");       // right

    // leaves texture
    for(let i=0;i<280;i++){
      const x = (bx + (Math.random()*bw))|0;
      const y = (by + (Math.random()*bh))|0;
      const onBorder = (y < by+pad || y > by+bh-pad || x < bx+pad || x > bx+bw-pad);
      if(!onBorder) continue;
      pxRect(x, y, 2, 2, (i%2===0) ? "#3aa86a" : "#1f5f40");
    }

    // roses
    for(let i=0;i<60;i++){
      const side = i%4;
      let x,y;
      if(side===0){ x = bx + (Math.random()*bw)|0; y = by + (Math.random()*pad)|0; }
      if(side===1){ x = bx + (Math.random()*bw)|0; y = by+bh-pad + (Math.random()*pad)|0; }
      if(side===2){ x = bx + (Math.random()*pad)|0; y = by + (Math.random()*bh)|0; }
      if(side===3){ x = bx+bw-pad + (Math.random()*pad)|0; y = by + (Math.random()*bh)|0; }
      // rose bud (chunky)
      pxRect(x, y, 6, 6, "#ff2d6f");
      pxRect(x+2, y+2, 2, 2, "rgba(255,255,255,0.35)");
    }
  }

  function drawPixelHeart(x,y,size,t){
    const p = 1 + Math.sin(t*0.01)*0.08;
    const s = size*p;
    // heart blocky
    pxRect(x - s*0.50, y - s*0.20, s*0.35, s*0.35, "#ff2d6f");
    pxRect(x + s*0.15, y - s*0.20, s*0.35, s*0.35, "#ff2d6f");
    pxRect(x - s*0.50, y + s*0.15, s*1.00, s*0.35, "#ff2d6f");
    pxRect(x - s*0.15, y + s*0.50, s*0.30, s*0.30, "#ff2d6f");
    pxRect(x - s*0.25, y - s*0.08, s*0.12, s*0.12, "rgba(255,255,255,0.35)");
  }

  function drawFood(t){
    const cx = fieldX + food.x*CELL + CELL/2;
    const cy = fieldY + food.y*CELL + CELL/2;
    drawPixelHeart(cx, cy, 12, t);
  }

  function drawSnake(t){
    // Connected segments: fill the full cell (no gaps)
    for(let i=snake.length-1;i>=0;i--){
      const s = snake[i];
      const x = fieldX + s.x*CELL;
      const y = fieldY + s.y*CELL;
      const head = (i===0);

      // body
      pxRect(x, y, CELL, CELL, head ? "#a36bff" : "#6f2cff");

      // outline
      ctx.strokeStyle = "rgba(255,255,255,0.15)";
      ctx.strokeRect(x+0.5, y+0.5, CELL-1, CELL-1);

      // head details
      if(head){
        // eyes
        pxRect(x+5, y+6, 4, 4, "rgba(255,255,255,0.95)");
        pxRect(x+CELL-9, y+6, 4, 4, "rgba(255,255,255,0.95)");
        pxRect(x+6, y+7, 2, 2, "#1b0f22");
        pxRect(x+CELL-8, y+7, 2, 2, "#1b0f22");

        // little mouth line
        pxRect(x+7, y+CELL-7, CELL-14, 2, "rgba(0,0,0,0.25)");
      }
    }
  }

  // ===== Menu drawings (no external images) =====
  function drawClosedLetter(t){
    const cx = W/2, cy = 360;
    const bob = (Math.sin(t*0.003)*6)|0;

    // envelope shadow
    pxRect(cx-92, cy+70+bob, 184, 10, "rgba(0,0,0,0.25)");

    // envelope body (chunkier)
    pxRect(cx-96, cy-46+bob, 192, 128, "#f2d7b7");
    ctx.strokeStyle = "rgba(0,0,0,0.30)";
    ctx.strokeRect(cx-96+0.5, cy-46+bob+0.5, 191, 127);

    // flap lines
    ctx.strokeStyle = "rgba(0,0,0,0.22)";
    ctx.beginPath();
    ctx.moveTo(cx-96, cy-46+bob); ctx.lineTo(cx, cy+12+bob);
    ctx.lineTo(cx+96, cy-46+bob);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(cx-96, cy+82+bob); ctx.lineTo(cx, cy+12+bob);
    ctx.lineTo(cx+96, cy+82+bob);
    ctx.stroke();

    // heart seal
    drawPixelHeart(cx, cy+16+bob, 18, t);

    // text
    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.font = "16px system-ui";
    ctx.fillText("Tap to open‚Ä¶", (W/2-60)|0, 146);
  }

  function drawOpenLetter(t){
    const cx = W/2, cy = 380;
    const bob = (Math.sin(t*0.003)*4)|0;

    // envelope base
    pxRect(cx-118, cy+26+bob, 236, 106, "#f2d7b7");
    ctx.strokeStyle = "rgba(0,0,0,0.28)";
    ctx.strokeRect(cx-118+0.5, cy+26+bob+0.5, 235, 105);

    // page
    pxRect(cx-102, cy-140+bob, 204, 180, "#fff2dc");
    ctx.strokeStyle = "rgba(0,0,0,0.16)";
    ctx.strokeRect(cx-102+0.5, cy-140+bob+0.5, 203, 179);

    // triangle flap (not rectangle)
    ctx.fillStyle = "#e7caa8";
    ctx.beginPath();
    ctx.moveTo(cx-118, cy+26+bob);
    ctx.lineTo(cx, cy-34+bob);
    ctx.lineTo(cx+118, cy+26+bob);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "rgba(0,0,0,0.22)";
    ctx.stroke();

    // fancy note
    ctx.textAlign = "center";
    ctx.fillStyle = "rgba(30,10,25,0.95)";
    ctx.font = "36px 'Great Vibes', cursive";
    ctx.fillText(`Dear ${NAME},`, cx, cy-82+bob);
    ctx.font = "28px 'Great Vibes', cursive";
    ctx.fillText("I made this little game‚Ä¶", cx, cy-44+bob);
    ctx.fillText("Collect 50 hearts üíñ", cx, cy-12+bob);
    ctx.textAlign = "left";

    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.font = "14px system-ui";
    ctx.fillText("Tap to start", (W/2-38)|0, 146);
  }

  // ===== Scroll win screens =====
  function drawScrollClosed(t){
    // background tint
    pxRect(0,0,W,H,"rgba(255,90,166,0.10)");

    const cx = W/2, cy = 360;
    const bob = (Math.sin(t*0.003)*5)|0;

    // rolled scroll (tube)
    pxRect(cx-80, cy-20+bob, 160, 70, "#e7caa8");
    ctx.strokeStyle = "rgba(0,0,0,0.25)";
    ctx.strokeRect(cx-80+0.5, cy-20+bob+0.5, 159, 69);

    // end caps
    pxRect(cx-92, cy-10+bob, 12, 50, "#caa37b");
    pxRect(cx+80, cy-10+bob, 12, 50, "#caa37b");

    // ribbon
    pxRect(cx-18, cy+6+bob, 36, 12, "#ff2d6f");
    pxRect(cx-10, cy-2+bob, 20, 28, "rgba(255,255,255,0.12)");

    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.font = "16px system-ui";
    ctx.fillText("You did it. Tap to open‚Ä¶", (W/2-86)|0, 146);
  }

  function drawScrollOpen(t){
    // parchment open
    pxRect(34, 230, W-68, 240, "#fff2dc");
    ctx.strokeStyle = "rgba(0,0,0,0.20)";
    ctx.strokeRect(34.5, 230.5, W-69, 239);

    // scroll rods
    pxRect(26, 230, 10, 240, "#caa37b");
    pxRect(W-36, 230, 10, 240, "#caa37b");

    // note
    ctx.textAlign = "center";
    ctx.fillStyle = "rgba(30,10,25,0.95)";
    ctx.font = "44px 'Great Vibes', cursive";
    ctx.fillText("Will you be", W/2, 320);
    ctx.fillText("my Valentine?", W/2, 380);
    ctx.textAlign = "left";

    ctx.fillStyle = "rgba(0,0,0,0.45)";
    ctx.font = "14px system-ui";
    ctx.fillText("Screenshot this if you want üíñ", 60, 456);
  }

  // ===== Game step =====
  let acc = 0;
  const STEP_MS = 110;

  function stepGame(){
    if(won) return;

    dir = nextDir;
    const head = snake[0];
    const nh = { x: head.x + dir.x, y: head.y + dir.y };

    // wall crash = restart
    if(nh.x < 0 || nh.x >= COLS || nh.y < 0 || nh.y >= ROWS){
      resetGame();
      return;
    }

    // self crash = restart
    for(let i=1;i<snake.length;i++){
      if(snake[i].x === nh.x && snake[i].y === nh.y){
        resetGame();
        return;
      }
    }

    snake.unshift(nh);

    // eat
    if(nh.x === food.x && nh.y === food.y){
      score++;
      updateCounter();
      food = spawnFood();

      // extra petals burst
      for(let i=0;i<8;i++){
        petals.push({
          x: fieldX + nh.x*CELL + CELL/2,
          y: fieldY + nh.y*CELL + CELL/2,
          vx: -0.6 + Math.random()*0.5,
          vy:  0.15 + Math.random()*0.6,
          t: Math.random()*999
        });
      }

      if(score >= TARGET){
        won = true;
        state = "scrollClosed";
        dpad.style.display = "none";
        hint.style.display = "none";
      }
    } else {
      snake.pop();
    }
  }

  // ===== Main loop =====
  function loop(t){
    // Clear
    ctx.clearRect(0,0,W,H);

    // Background
    drawChunkySky(t);
    drawPetals();

    // Grid + border is always visible for theme consistency
    drawRoseBushBorder();
    drawGridFloor();

    if(state === "menuClosed"){
      dpad.style.display = "none";
      hint.style.display = "none";
      counterEl.textContent = `‚ù§ 0/${TARGET}`;
      drawClosedLetter(t);

    } else if(state === "menuOpen"){
      dpad.style.display = "none";
      hint.style.display = "none";
      counterEl.textContent = `‚ù§ 0/${TARGET}`;
      drawOpenLetter(t);

    } else if(state === "game"){
      dpad.style.display = "block";
      hint.style.display = "block";

      acc += 16.7;
      if(acc >= STEP_MS){ acc = 0; stepGame(); }

      drawFood(t);
      drawSnake(t);

    } else if(state === "scrollClosed"){
      // freeze background + glow
      drawFood(t);
      drawSnake(t);
      pxRect(0,0,W,H,"rgba(255,90,166,0.12)");
      drawScrollClosed(t);

    } else if(state === "scrollOpen"){
      // open scroll note screen
      pxRect(0,0,W,H,"rgba(255,90,166,0.12)");
      drawScrollOpen(t);
    }

    requestAnimationFrame(loop);
  }

  // Start
  resetGame();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
