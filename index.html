<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Lucky Tap</title>
  <style>
    :root { --bg:#0b1020; --card:#111a33; --text:#e8eeff; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% -10%, #1a2a66 0%, var(--bg) 60%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      touch-action: manipulation;
    }
    .wrap { width: min(520px, 100%); }
    .top {
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      background: rgba(17,26,51,.7);
      border: 1px solid rgba(255,255,255,.08);
      padding: 12px 14px; border-radius: 14px;
      backdrop-filter: blur(8px);
    }
    .stat { display:flex; gap:8px; align-items:baseline; }
    .k { opacity:.75; font-size: 12px; letter-spacing:.2px; }
    .v { font-weight: 800; font-size: 18px; }
    .btns { display:flex; gap:10px; }
    button {
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px; border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
    }
    button:active { transform: scale(.98); }
    .hint {
      margin: 12px 0 10px;
      background: rgba(17,26,51,.45);
      border: 1px solid rgba(255,255,255,.08);
      padding: 12px 14px; border-radius: 14px;
      line-height: 1.35;
    }
    .hint b { color: #ffffff; }
    .grid {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    .orb {
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:flex; align-items:center; justify-content:center;
      position: relative;
      overflow:hidden;
      user-select:none;
      font-weight: 900;
      font-size: 18px;
    }
    .orb::before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18) 0%, rgba(255,255,255,0) 55%);
      transform: rotate(25deg);
    }
    .orb:active { transform: scale(.98); }
    .orb .dot{
      width: 54%; height: 54%;
      border-radius: 999px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
      border: 1px solid rgba(255,255,255,.16);
    }
    .msg {
      margin-top: 12px;
      min-height: 24px;
      font-weight: 700;
      opacity: .92;
    }
    .good { color: #70ffb6; }
    .bad { color: #ff7a7a; }
    .footer { opacity:.7; font-size: 12px; margin-top: 10px; }
    .shake { animation: shake .18s linear 2; }
    @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-4px)} 50%{transform:translateX(4px)} 75%{transform:translateX(-3px)} 100%{transform:translateX(0)} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="stat"><div class="k">TIME</div><div class="v" id="time">30.0</div></div>
      <div class="stat"><div class="k">SCORE</div><div class="v" id="score">0</div></div>
      <div class="stat"><div class="k">STREAK</div><div class="v" id="streak">0</div></div>
      <div class="btns">
        <button id="startBtn">Start</button>
        <button id="howBtn">How</button>
      </div>
    </div>

    <div class="hint" id="hint">
      Tap <b>Start</b>. Then find the correct orb each round.
    </div>

    <div class="grid" id="grid"></div>

    <div class="msg" id="msg"></div>
    <div class="footer">Randomized every round. Works offline once loaded.</div>
  </div>

<script>
(() => {
  const elTime = document.getElementById('time');
  const elScore = document.getElementById('score');
  const elStreak = document.getElementById('streak');
  const elHint = document.getElementById('hint');
  const elMsg = document.getElementById('msg');
  const grid = document.getElementById('grid');
  const startBtn = document.getElementById('startBtn');
  const howBtn = document.getElementById('howBtn');

  const ORBS = 6;
  let running = false;
  let score = 0;
  let streak = 0;
  let timeLeft = 30_000; // ms
  let t0 = 0;
  let raf = null;

  let answerIndex = 0;
  let answerHue = 0;
  let labels = [];

  function rnd(n) { return Math.floor(Math.random() * n); }
  function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function fmtTime(ms) { return (ms / 1000).toFixed(1); }

  function setMsg(text, cls) {
    elMsg.className = "msg " + (cls || "");
    elMsg.textContent = text || "";
  }

  function makeRound() {
    // Randomize labels + correct answer each round
    labels = shuffle(["A","B","C","D","E","F"].slice(0, ORBS));
    answerIndex = rnd(ORBS);

    // Make a random target "color clue"
    answerHue = rnd(360);
    const clue = labels[answerIndex];

    elHint.innerHTML =
      `Round target: tap orb <b>${clue}</b> ` +
      `(it has the warmest glow this round).`;

    renderGrid();
    setMsg("");
  }

  function colorFor(i) {
    // Each orb gets a color; answer gets slightly "warmer" (more red/yellow)
    const base = (answerHue + i * (280 / ORBS) + rnd(10)) % 360;
    const isAns = i === answerIndex;

    const hue = isAns ? ((base + 12) % 360) : base;
    const sat = isAns ? 92 : 78;
    const lit = isAns ? 60 : 52;

    return `hsl(${hue} ${sat}% ${lit}%)`;
  }

  function renderGrid() {
    grid.innerHTML = "";
    for (let i = 0; i < ORBS; i++) {
      const btn = document.createElement("div");
      btn.className = "orb";
      btn.setAttribute("role", "button");
      btn.setAttribute("aria-label", "Orb " + labels[i]);

      const dot = document.createElement("div");
      dot.className = "dot";
      dot.style.background = colorFor(i);

      // Random micro-variation each render (keeps it feeling "alive")
      dot.style.boxShadow = `0 0 ${12 + rnd(10)}px rgba(255,255,255,${0.10 + Math.random()*0.10})`;

      const txt = document.createElement("div");
      txt.style.position = "absolute";
      txt.style.bottom = "10px";
      txt.style.right = "12px";
      txt.style.opacity = ".85";
      txt.textContent = labels[i];

      btn.appendChild(dot);
      btn.appendChild(txt);

      btn.addEventListener("pointerdown", () => onTap(i), { passive: true });
      grid.appendChild(btn);
    }
  }

  function onTap(i) {
    if (!running) return;

    const correct = i === answerIndex;
    if (correct) {
      streak++;
      // Score grows with streak. Random tiny bonus keeps it spicy.
      const gained = 10 + streak * 2 + rnd(4);
      score += gained;
      setMsg(`Correct. +${gained}`, "good");
    } else {
      streak = 0;
      score = Math.max(0, score - 3);
      setMsg("Wrong. Streak reset.", "bad");
      grid.classList.remove("shake");
      void grid.offsetWidth; // restart anim
      grid.classList.add("shake");
    }
    elScore.textContent = score;
    elStreak.textContent = streak;

    // Next round, fast.
    makeRound();
  }

  function loop(now) {
    if (!running) return;

    if (!t0) t0 = now;
    const dt = now - t0;
    t0 = now;

    timeLeft -= dt;
    if (timeLeft <= 0) {
      timeLeft = 0;
      elTime.textContent = fmtTime(timeLeft);
      endGame();
      return;
    }

    elTime.textContent = fmtTime(timeLeft);
    raf = requestAnimationFrame(loop);
  }

  function startGame() {
    running = true;
    score = 0;
    streak = 0;
    timeLeft = 30_000;
    t0 = 0;

    elScore.textContent = score;
    elStreak.textContent = streak;
    elTime.textContent = fmtTime(timeLeft);

    setMsg("Go.", "");
    makeRound();

    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(loop);

    startBtn.textContent = "Restart";
  }

  function endGame() {
    running = false;
    if (raf) cancelAnimationFrame(raf);
    raf = null;

    const best = Number(localStorage.getItem("luckyTapBest") || "0");
    const newBest = Math.max(best, score);
    localStorage.setItem("luckyTapBest", String(newBest));

    setMsg(`Time. Score: ${score}. Best: ${newBest}.`, "");
    elHint.innerHTML = `Tap <b>Restart</b> to play again.`;
  }

  startBtn.addEventListener("click", startGame);
  howBtn.addEventListener("click", () => {
    elHint.innerHTML =
      `<b>How to play</b><br>` +
      `• Tap Start.<br>` +
      `• Each round, tap the orb with the target letter.<br>` +
      `• Correct gives more points as your streak grows.<br>` +
      `• Wrong resets streak.`;
  });

  // Initial grid (not running)
  makeRound();
})();
</script>
</body>
</html>
